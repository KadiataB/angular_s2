<div class="container">
  <!-- En-tÃªte -->
  <div style="margin-bottom: 32px;">
    <h1 class="page-title">
      <i class="bi bi-box-seam"></i>
      Gestion des Approvisionnements
    </h1>
  </div>

  <!-- Filtres et recherche -->
  <div class="card">
    <h2 class="section-title">
      <i class="bi bi-funnel"></i>
      Filtres et recherche
    </h2>

    <div class="grid grid-4" style="margin-bottom: 16px;">
      <input type="text"
             placeholder="ðŸ” Rechercher..."
             class="form-input"
             [value]="searchTerm()"
             (input)="searchTerm.set($any($event.target).value)">

      <select class="form-select"
              [value]="selectedFournisseur()"
              (change)="selectedFournisseur.set($any($event.target).value)">
        <option value="">Tous les fournisseurs</option>
        <option *ngFor="let f of fournisseurs" [value]="f">{{ f }}</option>
      </select>

      <select class="form-select"
              [value]="selectedArticle()"
              (change)="selectedArticle.set($any($event.target).value)">
        <option value="">Tous les articles</option>
        <option *ngFor="let a of articlesDisponibles" [value]="a">{{ a }}</option>
      </select>

      <select class="form-select"
              [value]="tri()"
              (change)="tri.set($any($event.target).value)">
        <option value="date_desc">ðŸ“… Date (rÃ©cent â†’ ancien)</option>
        <option value="date_asc">ðŸ“… Date (ancien â†’ rÃ©cent)</option>
      </select>
    </div>

    <div class="grid grid-3" style="align-items: end;">
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 14px; color: var(--text-secondary); white-space: nowrap;">Du</span>
        <input type="date"
               class="form-input"
               [value]="dateDebut()"
               (input)="dateDebut.set($any($event.target).value)">
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 14px; color: var(--text-secondary); white-space: nowrap;">Au</span>
        <input type="date"
               class="form-input"
               [value]="dateFin()"
               (input)="dateFin.set($any($event.target).value)">
      </div>
      <div>
        <a routerLink="/add" class="btn btn-primary">
          <i class="bi bi-plus-circle"></i>
          Nouvel approvisionnement
        </a>
      </div>
    </div>
  </div>

  <hr style="border: none; border-top: 1px solid var(--border); margin: 24px 0;">

  <!-- Tableau -->
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>RÃ©fÃ©rence</th>
          <th>Date</th>
          <th>Fournisseur</th>
          <th>Articles</th>
          <th>Montant total</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let appro of filteredApprovisionnements()">
          <td style="font-weight: 500;">{{ appro.reference }}</td>
          <td>{{ appro.date | date:'dd/MM/yyyy' }}</td>
          <td>{{ appro.fournisseur }}</td>
          <td>{{ appro.articles.length }} articles</td>
          <td style="font-weight: 500;">{{ appro.montantTotal | number }} FCFA</td>
          <td>
            <span class="badge">
              {{ getStatutText(appro.statut) }}
            </span>
          </td>
          <td>
            <div class="actions" style="display:flex;gap:8px;">
              <button class="icon-btn" title="Voir"><i class="bi bi-eye"></i></button>
              <button class="icon-btn" title="Ã‰diter"><i class="bi bi-pencil-square"></i></button>
              <button class="icon-btn" title="Supprimer" style="color: red;"><i class="bi bi-trash"></i></button>

            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Statistiques -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3 class="card-title"><i class="bi bi-graph-up"></i> Total des approvisionnements</h3>
      <div class="stat-value">{{ totalApprovisionnements() | number }} FCFA</div>
      <div class="stat-label">Total gÃ©nÃ©ral</div>
    </div>

    <div class="stat-card">
      <h3 class="card-title"><i class="bi bi-receipt"></i> Nombre d'approvisionnements</h3>
      <div class="stat-value">{{ nombreApprovisionnements() }}</div>
      <div class="stat-label">Total gÃ©nÃ©ral</div>
    </div>

    <div class="stat-card">
      <h3 class="card-title"><i class="bi bi-person-circle"></i> Fournisseur principal</h3>
      <div class="stat-value">{{ fournisseurPrincipal().nom }}</div>
      <div class="stat-label">
        {{ fournisseurPrincipal().montant | number }} FCFA
        ({{ fournisseurPrincipal().pourcentage | number:'1.1-1' }}%)
      </div>
    </div>
  </div>
</div>
